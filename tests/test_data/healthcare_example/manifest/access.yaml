entra_id:
- description: NM uses Microsoft Entra to manage access.
- fields:
    id [str]: The actual ID.

entra_group:
- description: Entra can have security groups used to control access.
- fields:
    name [str]: The group name.
- question: >
    How does the NM ID relate to the Entra ID? Is the NM ID used to generate an Entra
    ID, which is what is actually used for access?
- question: >
    B2B accounts just allow Entra IDs from different orgs to be used, right? Does B2B
    only work between orgs both using Microsoft?
- question: >
    Cloud Ops manages cloud permissions, right? Does NM use Entra for Databricks too?
- question: For stg and prd environments are there just two separate Entra groups?
- question: How do job codes relate to entra groups?
- question: How are regular and PA accounts linked?
- question: >
    Consider a well-defined human-intuitive group (e.g. power users). Are all
    permissions for that group recorded in one location and then propagated to other
    systems and environments?
- question: Is there a primer on how IAM works at NM?

nu_role:
- fields:
    net_id [str]: Unique identifier for NU.

nm_role:
- fields:
    nm_id [str]:
    pa_id [str]: If the user has a privileged access account.
    job_code [str]: Unique identifier for their job.

fsm_analyst_role:
- description: Individuals who fulfill data requests.
- fields:
    nm_id [str]:
    nu_id [str]:
- primary_key: nm_id
- foreign_keys:
    nm_id: nm_role.nm_id
    nu_id: nu_role.nu_id

ra_team_member_role:
- fields:
    entra_id [str]:
- foreign_keys:
    nm_id: fsm_analyst_role.nm_id

power_user_role:
- fields:
    entra_id [str]:
- foreign_keys:
    nm_id: fsm_analyst_role.nm_id

rhlcc_group:
- fields:
    entra_id [str]:

nm_compatible_role:
- fields:
    nm_id [str]: Unique identifier.
    identity_type [categorical]:
        description: Type of identity.
        categories:
            - employee
            - person_of_interest
            - b2b

requester:
- description: The person submitting the request.
- fields:
    nm_id [str]:
- foreign_keys:
    nm_id: nm_compatible_role.nm_id

support_team_member:
- description: >
    Member of the team responsible for supporting FSM use of the NMEDW,
    among other things.
- fields:
    nu_id [str]:
- foreign_keys:
    nu_id: nu_role.nu_id

pbi_workspace_role:
- fields:
    user [person]: The user for the role.
    workspace [workspace]: The PBI workspace in question.
    role [categorical]: The PBI role.

grant_analyst_access:
- task
- satisfies: can_grant_access_to_analyst
- child: grant_analyst_pa_account
- child: grant_analyst_azdo_access
- child: grant_analyst_databricks_access
- child: grant_analyst_vm_access
- status: in development

grant_analyst_pa_account:
- task
- satisfies: can_grant_analyst_pa_account
- status: in development

grant_analyst_azdo_access:
- task
- satisfies: can_grant_analyst_azdo_access
- status: in development

grant_analyst_databricks_access:
- task
- satisfies: can_grant_analyst_databricks_access
- status: in development

grant_analyst_vm_access:
- description: Only necessary for [power_user_role].
- task
- satisfies: can_grant_analyst_vm_access
- status: in development

set_report_access:
- task
- satisfies: can_control_report_access
- child: create_and_sync_security_groups
- child: apply_security_groups_to_reports
- status: in development

create_and_sync_security_groups:
- description: >
    Using the eIRB authorized personnel list as a base the IAM team can create a script
    that creates one security group per study.
- task

apply_security_groups_to_reports:
- task
- child: apply_security_groups_to_pbi_reports
- child: apply_security_groups_to_sharepoint_folders

AzNPDResearchAnalyticsTeam:
- description: Azure non-PRD security group for RA team members.
- fields:
    nm_id [str]:
- foreign_keys:
    nm_id: nm_compatible_role.nm_id

AzPRDResearchAnalyticsTeam:
- description: Azure PRD security group for RA team members.
- fields:
    nm_id [str]:
- foreign_keys:
    nm_id: nm_compatible_role.nm_id

AzNPDFSMPowerUserTeam:
- description: Azure non-PRD security group for power users.
- fields:
    nm_id [str]:
- foreign_keys:
    nm_id: nm_compatible_role.nm_id

AzPRDFSMPowerUserTeam:
- description: Azure PRD security group for power users.
- fields:
    nm_id [str]:
- foreign_keys:
    nm_id: nm_compatible_role.nm_id

fsm_finance_nm_security_group:
- name: NU FSM Finance Team - PBI Access
- url: https://myaccount.microsoft.com/groups/ff883225-fd42-46dc-8e7c-2082a0ddb70c
- fields:
    nm_id [str]:
- foreign_keys:
    nm_id: nm_compatible_role.nm_id